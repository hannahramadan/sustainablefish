{% extends 'base.html' %}

{% block title %}Sustainable Seafood{% endblock %}

{% block body %}

<p><b>Email: {{user.email}}</b></p>

<div>
    <p id=zip{{user.zip_code}} value={{user.zip_code}}>Shop local farmer's makets near <b>{{user.zip_code}}:</b></p>
    <ul id="marketplaces"></ul>
</div>

<h4>Your Watchlist</h4>
<div class="row">
    <!-- Create bootstrap container for fish -->
    {% if favorites|length == 0 %}
    <p>No seafood to display</p>
    {% else %}
        {% for fish in favorites %}
        <div class="card" style="width: 18rem;">
            <img src="{{ fish.img_url }}" class="card-img-top card-img" alt="{{fish.name}}">
            <div class="card-body">
                <h5 class="card-title"><a href="/species/{{ fish.fish_id }}">{{fish.name}}</a></h5>
                <h6 class="card-subtitle mb-2 text-muted">Sustainability Rating: <b>{{fish.score}}</b></h6>
                <!-- Query favorites table and display user favorited fish -->
                {% if fish in favorites %}
                    <form id="favorite" action='/favorite_fish/{{fish.fish_id}}' method='POST' >
                        <button type="button" id='fave{{fish.fish_id}}' name = "{{fish.fish_id}}" value = "{{fish.fish_id}}" class="card-link">Remove from watchlist</button>
                    </form>       
                    {% else %}          
                        <form id="favorite" action='/favorite_fish/{{fish.fish_id}}' method='POST' >
                            <button type="button" id='fave{{fish.fish_id}}' name = "{{fish.fish_id}}" value = "{{fish.fish_id}}" class="card-link">Add to watchlist</button>
                        </form>   
                    {% endif %} 
            </div>
        <!-- Script to handle watchlist button -->
        <script>
            $(`#fave{{fish.fish_id}}`).on('click', (evt) => {
                evt.preventDefault();
                fish_id = $(`#fave{{fish.fish_id}}`).val()
                $.post("favorite_fish/{{fish.fish_id}}", fish_id, (res) =>{
                    $(`#fave{{fish.fish_id}}`).html(res)
                    location.reload()
                });
            });
        </script>
      </div>
      {% endfor %}
  </div>
  {% endif %} 

    <script> // Call Farmer's Market API
        let zip = $('#zip{{user.zip_code}}').attr('value')
        getMarkets(zip)
    </script>

    {% endblock %}



